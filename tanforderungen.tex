\chapter{Konzeption der technischen Umsetzung}\label{chapter:tanforderungen}
Das Ziel des folgende Kapitel ist, zu erläutern, wie auf Basis der aufgestellten, gesetzlichen und funktionalen Anforderungen, ein der Zielsetzung dieser Arbeit entsprechender Messengerdienst erstellt werden kann. Das im folgenden Kapitel erstellte Konzept zur Umsetzung des Dienstes soll als Leitfaden für die reale Erstellung des Messengers dienen. 

\section{Framework als Basis des Konzepts}\label{chapter:kr}
Um die Umsetzbarkeit der aufgestellten Anforderungen an den Messengerdienst in einem realistischen und ökonomischen Rahmen zu halten, wird davon abgesehen einen komplett neuen Messengerdienst von Grund auf aufzubauen. Es ist wesentlich effizienter die Entwicklung des Messengers auf einem bestehenden Framework aufzubauen, welches sich den Anforderungen entsprechend anpassen lässt.\footnote{Vgl. \cite[S. 107 ff.]{Johnson2005}}

\subsection{Auswahl des Frameworks}\label{chapter:am}
Als Grundlage für die Konzeption zur Umsetzung des Anforderungskatalogs würden eine Vielzahl von Frameworks in Frage kommen. Solange der dem Messanger zugrunde liegende Code offen und anpassbar ist und das Framework technisch eine End to End Verschlüsselung erlaubt und eine theoretische Einhaltung der allgemeinen DSGVO Richtlinien ermöglichen würde, kann durch genügend Anpassungen versucht werden, die aufgestellenten Anforderungen zu erfüllen. \footnote{siehe Anhang 1: Gesetzlicher Anforderungskatalog an einen Messengerdienst für den Austausch von Gesundheitsdaten}

Aus ökonomischer Sicht macht es jedoch am meisten Sinn, ein Framework zu wählen, welches möglichst wenig Anpassungen benötigt, um die Anforderungen zu erfüllen. Aus diesem Grund wurde für die Konzeption das Matrix Framework ausgewählt.
Matrix bietet eine robuste Codebasis, eine Vielzahl an integrierten Sicherheitsfunktionen, eine aktive Entwicklercommunity und eine, auf dem Framework aufbauende Beispielimplementierung eines Messangers mit einem großen Funktionsumfang.\footnote{Vgl. \cite{Matrix.org2020}} \footnote{Vgl. \cite{Github2020}}  Im Folgenden werden die Funktionen und Vorzüge des Frameworks weiter erläutert.

\subsection{Vorstellung des Matrix Frameworks}\label{chapter:vdmf}
Das Matrix-Projekt wurde von einer gemeinnützigen Stiftung mit Sitz in Großbritannien mit dem Ziel ins Leben gerufen, ein Framework für dezentrale Open-Source-Messaging-Dienste mit den Schwerpunkten Sicherheit, Datenschutz und Anpassungsfähigkeit zu entwickeln. Heute bietet Matrix eine robuste Codebasis zum Einrichten benutzerdefinierter Messaging-Dienste und bietet mit Element eine ergänzende Slack-ähnliche Benutzeroberfläche.\footnote{Vgl. \cite{Matrix.org2020}}

Matrix ist ein offener Standard und ein Kommunikationsprotokoll für  Echtzeitkommunikation. Matrix bietet ein Open Source Backend, welches über eine HTTP API erreicht werden kann und die Kernfunktionen des Dienstes bereitstellt.\footnote{Vgl. \cite{Matrix.org2020}} Matrix bietet ebenfalls ein Open Source Frontend, welches ein User Interface bereitstellt, über welches via der HTTP API mit dem Backend kommuniziert werden kann. Somit stellt Matrix ein vollständiges, exemplarisches, Open Source Backend und Frontend.\footnote{Vgl. \cite{Github2020}} 
Ein weiteres Alleinstellungsmerkmal von Matrix gegenüber anderer Standards ist zum einen, dass es mit einem besonderen Fokus auf Sicherheit entwickelt wurde und eine vollständig End zu End verschlüsselte Kommunikation  erlaubt,\footnote{Vgl. \cite[S. 1 ff.]{Nccgroup2016}} zum anderen, dass es dezentralisiert betrieben werden kann.\footnote{siehe Kapitel 3.1.2 im Abschnitt Matrix Architektur}

Aufgrund seiner hohen Sicherheitsstandards und seines dezentralen Ansatzes wurde Matrix  von der französischen Regierung ausgewählt, um die Basis für eine sichere Messenger-App zu schaffen und eine bessere Kommunikation in und zwischen verschiedenen Abteilungen der Regierung zu ermöglichen. Neben der französischen Regierung\footnote{Vgl. \cite{Republique-Francaise2018}} wählte auch die deutsche Bundeswehr\footnote{Vgl. \cite{Weiss2020}} Matrix als Basis für die Entwicklung eines internen Kommunikationsinstruments. Matrix wird also bereits in vergleichbaren Einsatzgebieten genutzt, um hochsensible Daten zu versenden.

\subsubsection{Matrix Funktionsumfang für den Nutzer}\label{chapter:aemn}
Von Haus aus verfügt Matrix bereits über einen sehr robusten Funktionsumfang, welcher im Folgenden vorgestellt wird.
Abbildung 1 zeigt das Matrix-Nutzerinterface. Chats werden in Einzel/ Gruppenchats und Räume aufgeteilt.

% Einfügen einer Grafik
\begin{figure}[htb]
    % Zentrierung
    \centering
    % Einfügen der Datei, mit angepasster Höhe
    \includegraphics[height=8cm]{graphics/unknown-3.png}
    % Titel und Label der Grafik
    \caption[Matrix UI]{Matrix UI: (1) Communityliste, (2) Chat- /Raumliste, (3) Chatfenster, (4) Teilnehmerliste.}
    \label{abb:UI}
\end{figure}

Während Chats für den Austausch zwischen ausgewählten Personen ausgelegt sind, werden Räume Themen spezifisch angelegt. Räume lassen sich zudem auch öffentlich stellen, sodass sie von anderen Nutzern über eine Suche gefunden werden können. Desweiteren bietet Matrix die Möglichkeit Chats und Räume zu sogenannten Communitys zusammenzustellen, welche dabei helfen das Interface übersichtlich zu halten.
Neben der Suche nach Räumen ist Matrix auch in der Lage nach im System hinterlegten Nutzern zu suchen. Die Chats selber bieten die von anderen Messengern wie Slack bereits bekannte Funktionen, wie das Teilen von Dateien, das Senden von Emoticons, das Antworten auf spezifische Nachrichten in Form von Threads oder das Reagieren auf Nachrichten durch Emoticons. Chats und Räume lassen sich mit einer bereitgestellten Suchfunktion durchsuchen. Räume und Chats verfügen auch über weitreichende Optionen zur Administration, darunter ein robustes System zur Vergabe von Rechten an Nutzer, wie zum Beispiel das Recht darauf Nutzer zum Chat/ Raum hinzuzufügen oder zu entfernen, das Recht Nachrichten in der entsprechenden Gruppe zu verschicken oder Nachrichten zu löschen. Besonders relevant für die spätere Konzeption ist auch die Möglichkeit seitens Matrix Nachrichten nur für einen bestimmten Zeitraum zu speichern.
Neben den eigentlichen Chat Funktionen können über Matrix auch Video und Audio Telefonate mit Einzelpersonen oder Gruppen geführt werden.\footnote{Vgl. \cite{Matrix.org2020}} Beim Nutzerprofil erlaubt Matrix es dem Nutzer eine Reihe von Identifikatoren, wie E-Mail oder Telefonnummer im eigenen Nutzerprofil zu hinterlegen, ein Profilbild anzulegen, das Erscheinungsbild des Messengers zu personalisieren, oder das eigene Passwort zu ändern.\footnote{Vgl. \cite{Github2020}}

\subsubsection{Matrix Architektur}\label{chapter:aemn}
Eines der großen Alleinstellungsmerkmale Merkmale des Matrix Frameworks ist der dezentralisierte Aufbau, welcher es erlaubt multiple Matrix Instanzen voneinander unabhängig zu betreiben, welche dennoch in der Lage sind, miteinander zu kommunizieren. Eine Matrixinstanz innerhalb eines Netzwerkes folgt dabei dem folgenden, durch Abbildung 2 visualisierten, Aufbau:

% Einfügen einer Grafik
\begin{figure}[htb]
    % Zentrierung
    \centering
    % Einfügen der Datei, mit angepasster Höhe
    \includegraphics[height=9cm]{graphics/ma.png}
    % Titel und Label der Grafik
    \caption[Matrix Netzwerk Architektur]{Matrix Netzwerk Architektur\footnotemark}
    \label{abb:DHBWLogo}
\end{figure}
\footnotetext{\cite{Prokop2015}}

Im Zentrum jeder Matrix Instanz steht der sogenannte Homeserver. Jeder Homeserver stellt dabei eine eigene Instanz des Messengers dar, welcher in Kombination mit einer Datenbank als Speicher und einem Frontend, welches mit den API Schnittstellen des Homeservers kommuniziert, betrieben werden kann. Jeder Nutzer (Client) des Matrixnetzwerks ist dabei einem Homeserver zugeordnet, über welchen sein Account verifiziert wird und welcher für die Sicherung seiner Daten und Chatverläufe zuständig ist. Das besondere hierbei ist, dass die Kommunikation innerhalb von Matrix nicht auf einen einzelnen Homeserver beschränkt ist.\footnote{Vgl. \cite{Github2020}} Durch ein entsprechendes White bzw Blacklisting kann die Kommunikation mit anderen Homeservern erlaubt beziehungsweise eingeschränkt werden (siehe Anhang 3: Muster homeserver.yaml). Matrix geht dabei wie folgt vor:
Das Matrix Framework nutzt RESTful-HTTP-APIs zur sicheren Übertragung und Replikation von JSON Dateien zwischen Matrix-fähigen Clients, Servern und Diensten. Das Datenpaket wird mit HTTPS verschlüsselt und mit einem privat Key des Servers signiert, um Spoofing zu vermeiden.
Der Client sendet dieses Datenpaket an den gewählten \glqq Raum\grqq{} auf dem Matrix Homeserver. Dieser repliziert die Daten dann über alle Matrix-Server, die an diesem \glqq Raum\grqq{} teilnehmen. Somit ist es möglich, gezielt zwischen zwei oder mehr Homeservern zu kommunizieren und nur den Inhalt der Chats dieser Räume zwischen den Homeservern auszutauschen, ohne dass sämtliche auf den Datenbanken der Homeserver hinterlegten Chats ausgetauscht werden müssen. Zudem führt dies auch dazu, dass, sollte ein Homeserver aus Gründen nicht erreichbar sein, zum Beispiel durch einen Absturz oder Wartungen an dem System, die Kommunikation innerhalb und zwischen den anderen Homeservern des Netzwerks immer noch möglich ist.\footnote{Vgl. \cite{Github2020}} Für die Konzeption des Messangers ist allerdings erst einmal nur ein Homeserver pro Krankenhaus vorgesehen, welcher nur mit sich selbst kommunizieren kann und somit nur für die krankenhausinterne Kommunikation genutzt werden kann. \footnote{Vgl. \cite{Matirx.org-specifications2020}}

Für die Verwaltung von Nutzern ist es möglich einen sogenannten Identity Server mit dem eigenen Homeserver zu verknüpfen, welcher es erlaubt externe Nutzerverwaltungen zur Authentifikation gegenüber dem Homeserver zu Nutzen. Die Basis der Matrix internen Nutzerverwaltung bildet die sogenannte Matrix User IDs (MXID), welche wie folgt aufgebaut ist: \glqq @username:homeserver.tld\grqq{}. Diese ist einzigartig für jeden Nutzer. Darauf aufbauend können Third-party IDs (3PIDs) mit der MXID verbunden werden, wie zum Beispiel eine E-Mail-Adresse, eine Handynummer oder ein Display Name, welche die Identifikation einzelner Nutzer vereinfacht.\footnote{Vgl. \cite{Matirx.org-specifications2020}}
Wird kein Identiy Server mit dem Homeserver verbunden, kann ein Nutzerkonto direkt über den Homeserver erstellt werden. Hierfür kann ein, in der Konfiguration des Homeservers festgelegter 3PID in Kombination mit einem Passwort angegeben werden, worauf der Homeserver den Nutzer anlegt und eine passende MXID erstellt.\footnote{Vgl. \cite{Matirx.org-specifications2020}}
In der Regel ist es aber wünschenswert eine bereits bestehende Nutzerverwaltung mit dem Homeserver zu verknüpfen, da auf diese Weise die Nutzer keine zusätzlichen Accounts erstellen müssen, weil sie sich über die Nutzerverwaltung authentifizieren können und der Betreiber des Homeservers keine weitere Nutzerverwaltung extra für den Homeserver betreiben muss. Zum Verbinden eines Homeservers mit einer Nutzerverwaltung nutzt Matrix eine Reihe von Schnittstellen. Ein Beispiel für eine unterstütze Schnittstelle ist OpenID Connect, ein offener Standard für ein dezentralisiertes Authentifikation Protokoll. Andere unterstützte Matrix Schnittstellen sind CAS und SAML.\footnote{Vgl. \cite{Matirx.org-specifications2020}} \footnote{siehe Anhang 3: Muster homeserver.yaml} 

Neben externen Nutzerverwaltungen können auch andere Module an Matrix angebunden werden.\footnote{Vgl. \cite{Matirx.org-specifications2020}} Ein Beispiel für ein solches Modul ist das Videokonferenztool Jitsi. Wie auch Matrix basiert Jitsi auf einem Open Source Projekt und bietet einen robusten Dienst für Video und Audio Telefonate, vergleichbar mit anderen Anbietern auf dem Markt, wie zum Beispiel Zoom oder Skype. Matrix bietet zwar auch von Haus die Möglichkeit Video und Audio Telefonate zu führen, dabei ist der Funktionsumfang aber deutlich kleiner als der von Jitsi. Sollte also ein großer Fokus bei der Verwendung der Plattform auf Audio und Videotelefonaten liegen, würde es sinnvoll sein Jitsi als Modul an Matrix anzubinden. Bei Jitsi handelt es sich um nur ein Beispiel der Möglichkeiten Matrix für den eigenen Gebrauch anzupassen. 

\subsubsection{Matrix Verschlüsselung}\label{chapter:aemn}
Die End-to-End-Verschlüsselung in Matrix basiert auf den kryptografischen Modellen Olm und Megolm.\footnote{Vgl. \cite{Chishtie2018}}
Gespeicherte Konversationen können aufgrund dieser Verschlüsselung nur von Raum-Teilnehmern gelesen werden. Damit ist auch nicht möglich den Inhalt der Chats durch einen direkten zugriff auf den Server einzusehen.\footnote{Vgl. \cite[S. 1 ff.]{Nccgroup2016}}

Die vom Matrix  Team in C++ entwickelten kryptografischen Modelle Olm und Megolm  wurden einer kryptografischen Prüfung durch das Unternehmens NCC Group unterzogen. In der Prüfung wurden keine kritischen Lücken in den kryptografischen Modellen gefunden und durch die Prüfung offengelegte Sicherheitsprobleme wurden durch das Matrix Team behoben.  Die Resultate dieser Prüfung sind öffentlich einsehbar und die Überprüfung wurde durch den Open Technology Fund finanziert.\footnote{Vgl. \cite[S. 5 ff.]{Nccgroup2016}}

Für den Nutzer bedeutet die Matrix Verschlüsselung, dass bei der Erstellung eines neuen Accounts neben einem Passwort zusätzlich eine Passphrase anlegt werden muss, um die von Matrix gespeicherten Nachrichten zu entschlüsseln und somit auf Chatverläufe zugriff zu erhalten.
Die Eingabe der Passphrase ist für jedes neue Device notwendig (alternativ kann das neue Device auch über ein anderes Device, welches bereits entschlüsselt wurde, authentifiziert werden).\footnote{Vgl. \cite{Chishtie2018}}

Die End to End Verschlüsselung bringt eine Reihe von Vorteilen mit sich: Auch bei einem Diebstahl von Nutzername und Passwort sind alte Chatverläufe nicht einsehbar und somit geschützt, die Chats sind ebenfalls in der Datenbank verschlüsselt gespeichert und können somit auch durch einen dirkten Zugriff auf die Datenbank nicht eingesehen werden und die Nachrichten werden ausschließlich in verschlüsselter Form versendet und können somit, auch wenn sie abgefangen würden, nicht gelesen werden.\footnote{Vgl. \cite{Chishtie2018}}

\section{Konzeption des Messengers auf Basis des Matrix Frameworks}\label{chapter:km}
Das folgende Kapitel zeigt wie mit Hilfe des Matrix Frameworks ein, den aufgestellten funktionalen und gesetzlichen Anforderungen gerechter Messenger, konzipiert werden kann.
Die Implementierung des Matrix Frameworks als Basis des Messengerdienstes erlaubt es, einen Großteil der festgelegten Anforderungen, durch das Aufsetzen einer Matrix Instanz und einer entsprechenden Konfiguration des Frameworks zu erfüllen. Neben dem reinen Verweis auf die theoretischen Konzepte wurde die Umsetzung auch durch die Anfertigung eines Prototyps geprüft. Der Prototyp ist allerdings nicht Bestandteil dieser Arbeit, da eine zusätzliche Beschreibung des Prototyps den vorgegebenen Umfang dieser Arbeit überschreiten würde.  
Da es sich bei Matrix um ein Open Source Projekt handelt, können Anforderungen, welche sich nicht durch eine reine Konfiguration erfüllen lassen, durch Erweiterungen im Code umgesetzt werden.\footnote{Vgl. \cite{Github2020}}. Die Implementierung von Erweiterungen und der Konfigurationsprozess werden im folgenden erläutert.

\subsection{Konzept zur Umsetzung der funktionalen Anforderungen}\label{chapter:am}
Wie bereits beschrieben, ist einer der herausragenden Vorteile von Matrix, dass neben dem eigentlichen Framework auch ein vollständiges Front- und Backend zur Verfügung gestellt wird. Die Funktionen, die Matrix nach einer Installation des Dienstes bereits bietet, wurden bei der Vorstellung des Frameworks bereits genannt.\footnote{Vgl. \cite{Github2020}}

Für das Konzept zur Umsetzung der funktionalen Anforderungen wird nur eine, der Standard-Installation entsprechend nicht darüber hinaus konfigurierte Matrix Instanz vorausgesetzt. Nach der Installation werden bereits die grundlegenden Funktionen des Messengers in Form eines über den Browser erreichbaren Interfaces zur Verfügung gestellt und können getestet werden.\footnote{Vgl. \cite{Matrix.org2020}} Dieses erfüllt bereits alle funktionalen Anforderungen und somit kann sich im folgenden vollständig auf die Umsetzung der gesetzlichen Anforderungen konzentriert werden.
Der Installationsprozess wird in diesem Kapitel nicht weiter beschrieben, da es sich hierbei, je nach Betriebssystem und Rechenzentrum, um einen für jedes Krankenhaus individuellen Prozess handelt.
Wie das Experteninterview ergab, gibt es eine Vielzahl an möglichen Funktionen, mit welchen der Messenger erweitert werden könnte, um ihn für den Einsatz im Krankenhaus zu optimieren.\footnote{Vgl. Experteninterview Georg Woditsch} Auch wenn die Umsetzung dieser erweiterten Funktionen nicht unter die Zielsetzung der vorligenden Arbeit fällt, sollte an dieser Stelle angemerkt werden, dass eine Erweiterung des Messengers, dank der Matrix Open Source Lizenz, gut möglich ist und durch eine aktive Entwickler-Community und steigende Popularität eine kontinuierliche Weiterentwicklung seitens des Open Source Projektes durchaus möglich ist.\footnote{Vgl. \cite{Github2020}}

\subsection{Konzept zur Umsetzung der gesetzlichen Anforderungen}\label{chapter:vdmf}
Das Folgenden wird das Konzept zur Umsetzung der gesetzlichen Anforderungen an den Messengerdienst erarbeitet.
Die Basis hierfür bildet der im Kapitel 2.3. erstellte gesetzliche Anforderungskatalog speziell für den Messengerdienst. Für die Erstellung des Konzeptes wurden alle 37 Anforderungen analysiert und erörtert, wie diese technisch im Messenger durch das Matrix Framework umgesetzt werden können. Die Ansätze, wie die Anforderungen technisch umgesetzt werden können, wurden im Anforderungskatalog ergänzt. Bei Tablle 1 handelt es sich um einen Auszug aus dieser erweiterten Tabelle. 
\newpage
\begin{longtable}{p{0.6cm}|p{4cm}|p{5cm}|p{5cm}}
    \hline
Nr. & Anforderung                                                                                                                                                                                                                                                                                          & Umsetzung in Matrix          & Einordnung für den Messenger                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \\ \hline
1 &
  „Jegliche Erhebung, Verarbeitung und Nutzung personenbezogener oder personenbeziehbarer Daten - insbesondere durch den Einsatz von Datenaustauschplattformen, die an das Internet angebunden sind - bedarf einer datenschutzrechtlich wirksamen Einwilligung des Betroffenen.“\footnote{\cite[S. 41]{Bundesverband-Gesundheits-IT-e.V.2016}} &
  Matrix erlaubt es technisch Policys anzulegen, denen der User zustimmen muss, bevor er den Dienst nutzen kann. Die rechtlich wirksame Einwilligung des Nutzers kann somit, wie in der Anforderung beschrieben, als Policy angelegt werden. (siehe „Matrix Policys“ in Kapitel 3.2.2) &
  Anforderung 1 und 3 sind relevant, da sie für den Messenger bedeuten, dass dem Krankenhauspersonal die Möglichkeit gegeben werden muss, der Verarbeitung ihrer Nutzerdaten durch die Plattform zuzustimmen. Das gleiche gilt auch für die Patienten, deren Einwilligung über die für das Krankenhaus gültigen AGBs eingeholt werden muss, welche auch die Vorgaben zur allgemeinen Verarbeitung der Patientendaten innerhalb des Krankenhauses regeln.
  \\ \hline
... &
... &
... &
...
  \\ \hline

\caption{Auszug aus dem gesetzlichen Anforderungskatalog an einen Messengerdienst für den Austausch von Gesundheitsdaten, erweitert mit den Ansätzen zur Umsetzung durch das Matrix Framework} 
\end{longtable}

Die vollständige, erweiterte Tabelle befindet sich aus Gründen der Übersichtlichkeit im Anhang dieser Arbeit.\footnote{siehe Anhang 2: Gesetzlicher Anforderungskatalog an einenMessengerdienst für den Austausch von Gesundheitsdaten,erweitert mit den Ansätzen zur Umsetzung durch das Matrix Framework} 

Die Umsetzungen der einzelnen Anforderungen geschieht dabei durch eine entsprechende Konfiguration der aufgesetzten Matrix Instanz. Die in der erweiterten Tabelle gelisteten Ansätze beziehen sich vor allem auf eine Reihe von technischen Kernfunktionen seitens Matrix. Neben der Erläuterung wie die jeweilige Anforderung mit Matrix umgesetzt werden kann, wird in der Tabelle auf die betroffene Kernfunktion verwiesen. Diese Kernfunktionen sind die zentrale Konfiguration des Homeservers über die homeserver.yaml, das Anlegen von Matrix Policys,
die Anbindung eines externen Nutzerverzeichnisses und die Matrix Nutzer Administration. Diese werden im Folgenden vorgestellt und erläutert.

\subsubsection{Matrix Homeserver YAML}\label{chapter:vdmf}
Die homeserver.yaml Datei innerhalb des Matrix Homeservers ist der zentrale Anlaufpunkt für die Konfiguration des Homeservers.
Über die homeserver.yaml, werden vom Anbinden weiterer Komponenten an den Homeserver bis hin zur Einstellung von Upload limits für Media Dateien alle wichtigen Funktionen des Homeservers konfiguriert. Aus diesem Grund wird innerhalb der Beschreibungen zur Umsetzung des Anforderungskatalogs immer wieder auf Einstellungen in der homeserver.yaml verwiesen. Eine Beispielkonfiguration mit Erläuterungen befindet sich im Anhang dieser Arbeit.\footnote{siehe Anhang 3: Muster homeserver.yaml} 

\subsubsection{Matrix Policys}\label{chapter:vdmf}
Matrix erlaubt es sogenannte custom Policys anzulegen, über welche sich eine Reihe von Anforderungen an den Messengerdienst umsetzen lassen, welche sich auf AGBs und Datenschutzhinweise beziehen.
Der Matrix Homeserver kann so konfiguriert werden, dass Benutzern individuelle Richtlinienformulare mit der Schaltfläche \glqq Akzeptieren\grqq{} präsentiert werden können. Durch Klicken auf \glqq Akzeptieren\grqq{} wird die Akzeptanz des Benutzers in der Datenbank aufgezeichnet.\footnote{Vgl. \cite{Matrix.org-custom-policies2020}}

Um diese Funktion für Matrix zu aktivieren, muss zunächst die gewünschte Richtlinie im Dateisystem des Homeservers hinterlegt werden.

Die Richtlinie muss dabei die Jinja2 templating language verwenden.

Nachdem die gewünschte Richtlinie auf dem System hinterlegt wurde, müssen die folgenden Änderungen an der homeserver.yaml vorgenommen werden:

Der folgende Abschnitt muss der homeserver.yaml hinzugefügt werden, damit der Homeserver weiß, wo die gewünschte Policy abgelegt ist und um welche Version der Policy es sich handelt.\footnote{Vgl. \cite{Matrix.org-custom-policies2020}}

\begin{lstlisting}
user_consent:
    template_dir: <Dateipfad zur Policy>
    version: <Versionsnummer>
\end{lstlisting}

Das Tracking, ob Nutzer der Policy zugestimmt haben, kann mit der folgenden Konfiguration ermöglicht werden.\footnote{Vgl. \cite{Matrix.org-custom-policies2020}}

\begin{lstlisting}
user_consent:
    require_at_registration: true
    policy_name: <Name der Policy>
\end{lstlisting}

Matrix kann zudem so konfiguriert werden, dass der Dienste erst dann wieder genutzt werden kann, wenn der Policy zugestimmt wurde.\footnote{Vgl. \cite{Matrix.org-custom-policies2020}}
Dies geschieht über eine weitere Anpassung an der homeserver.yaml.

\begin{lstlisting}
user_consent:
    block_events_error: >-
        <Individuelle Nachricht die dem Nutzer angezeigt werden soll>
\end{lstlisting}

Diese Beschreibung soll dazu dienen ein grundsätzliches Verständis dafür zu bekommen, wie Policys in Matrix umgesetzt werden können.\footnote{Vgl. \cite{Matrix.org-custom-policies2020}}

\subsubsection{Matrix Message retention}\label{chapter:vdmf}
Innerhalb der Matrix homeserver.yaml des Matrix Homeservers kann eine sogenannte retention Policy festgelegt werden, welche die maximale Speicherdauer für alle über den Server versendeten Nachrichten festlegt. Beispielsweise kann eine retention Policy von 30 Tagen dafür sorgen, dass Nutzer nur die Nachrichten der letzten 30 Tage über den Messenger einsehen können und auch nur die Nachrichten der letzten 30 Tage in der Matrix Datenbank gespeichert werden. Die Konfiguration dieser Policy funktioniert wie folgt:

In der homeserver.yaml muss die retention Funktion aktiviert werden.\footnote{Vgl. \cite{Matrix.org-retentio-policies2020}}

\begin{lstlisting}
retention:
    enabled: true
\end{lstlisting}

Nachdem aktivieren kann eine serverweite retention Policy, wie im folgenden Beispiel, über die homeserver.yaml konfiguriert werden.\footnote{Vgl. \cite{Matrix.org-retentio-policies2020}}

\begin{lstlisting}
default_policy:
    max_lifetime: 30d
\end{lstlisting}

Nach einer Konfiguration, wie in diesem Beispiel, werden alle Nachrichten die älter als 30 Tage sind von der Datenbank des Homeservers gelöscht.

Neben einer serverweiten retention Policy kann auch eine retention Policy für individuelle Räume festgelegt werden, welche nach dem gleichen Prinzip funktioniert und von den Administratoren des entsprechenden Raumes aktiviert werden kann. Diese Funktion kann von Nutzen sein, wenn Räume zum Versenden besonders sensibler Daten vorgesehen sind. Hier könnte die retention auf zum Beispiel 48 Stunden gesetzt werden, um sicher zu gehen, dass die Daten nicht länger als unbedingt notwendig im Messenger gespeichert bleiben. Die retention Policy für individuelle Räume kann von Administratoren bei den Raum Einstellungen im Developer Feld mit dem Event Type \glqq m.room.retention\grqq{} folgenden Befehl festlegen:

\begin{lstlisting}
    "max_lifetime": <Gewünsche Dauer>
\end{lstlisting}

\subsubsection{Matrix Nutzerverzeichnis Anbindung am Beispiel von IBM APP ID}\label{chapter:vdmf}
Wie bereits in Kapitel 3.1.2 im Abschnitt \glqq Matrix Architektur\grqq{} beschrieben kann Matrix über eine Reihe von Standards mit externen Nutzerverwaltungen verbunden werden.\footnote{Vgl. \cite{Matirx.org-specifications2020}}
Je nach gewähltem Standard und Nutzerverwaltung kann sich der Prozess zur Anbindung unterscheiden. Um den Nutzen und die Funktionsweise einer externen Nutzerverwaltung im Zusammenhang mit Matrix zu erläutert, wird der Prozess im Folgenden beispielhaft durch die Anbindung des IBM Service APP ID per SAML an eine Matrix Instanz demonstriert. Bei APP ID handelt es sich um einen Service, welcher als Connector zwischen Applikation und Nutzerverwaltungen verstanden werden kann. APP ID kann über eine Reihe von Schnittstellen mit Programmen oder Web Applikationen verbunden werden, um deren Authentifikationsprozesse zu managen.\footnote{Vgl. \cite{IBM2020}} Einmal angebunden können über APP ID bausteinartig Authentifikationsmethoden der entsprechenden Software hinzugefügt werden. Beispiele hierfür sind Login per Google oder Facebook Account, die APP ID eigene Nutzerverwaltung oder über eine weitere externe Nutzerverwaltung, welche an APP ID angebunden wurde. Dabei bietet APP ID zudem eine Reihe von Sicherheitsfunktionen wie 2 Faktor Authentifikation.\footnote{Vgl. \cite{IBM2020}}
APP ID wurde mit dem Matrix Homeserver über die SAML Schnittstelle verbunden, welche in der homerserver.yaml entsprechend konfiguriert werden kann. Da sich der Prozess der Anbindung je nach Nutzerverwaltung und gewählter Schnittstelle unterscheidet, wird sich im Folgenden auf die Vorstellung der sich aus der Verbindung ergebenden Funktionen fokussiert, mit welchen sich eine Vielzahl der Anforderungen erfüllen lassen.

\begin{itemize}
    \item Mit einer entsprechenden Konfiguration können nur Personen, welche über die Nutzerverwaltung hinterlegt sind, auf den Messanger zugreifen und es müssen keine neuen Accounts erstellt werden.
\end{itemize}

% Einfügen einer Grafik
\begin{figure}[htb]
    % Zentrierung
    \centering
    % Einfügen der Datei, mit angepasster Höhe
    \includegraphics[height=5cm]{graphics/sso.png}
    % Titel und Label der Grafik
    \caption[Matrix Login über eine angebundene Nutzerverwaltung]{Matrix Login über eine angebundene Nutzerverwaltung.}
    \label{abb:DHBWLogo}
\end{figure}

\begin{itemize}
    \item Der Nutzer muss kein neues Passwort erstellen, sonder authentifiziert sich über das Nutzerverzeichnis (siehe Abbildung 3).
    \item Jeder Matrix Account kann dank der Nutzerverwaltung einer Person direkt zugeordnet werden, wodurch keine nicht zuordenbaren Aktivitäten auf dem Messanger vorkommen können.  
    \item Der Zugriff auf den Messanger 
dienst kann über die Nutzerverwaltung zentral überwacht werden und Sicherheitsfunktionen wie 2 Faktor Authentifikation für den Login verpflichtet werden. 
\end{itemize}

Da es keinen allgemeinen Standard für Nutzerverwaltungen in Krankenhäusern gibt, kann es sein, dass nicht jede Nutzerverwaltung über die gelisteten Funktionen verfügt und somit nicht für eine Authentifikation gegenüber des Messangers genutzt werden kann.\footnote{Vgl. Experteninterview Georg Woditsch} In diesem Fall sollte dennoch davon abgesehen werden, die matrixeigene Nutzerverwaltung zum Erstellen von Accounts zu nutzen, denn Matrix ist nicht in der Lage alle geforderten Funktionen wie 2 Faktor Authentifikation zu ermöglichen.\footnote{Vgl. \cite{Matirx.org-specifications2020}} Aus diesem Grund sollte in diesem Fall eine externe Nutzerverwaltung wie APP ID verwendet werden, welche über den benötigen Funktionsumfang verfügt.

\subsubsection{Matrix Nutzer Administration}\label{chapter:vdmf}
Für eine Administration von Chat Räumen bietet Matrix ein umfassendes Set an Rechten (siehe Abbildung 4) und Hierarchien mit denen es möglich ist, die Kommunikation im jeweiligen Chatraum zu managen.\footnote{Vgl. \cite{Matrix.org2020}}  Matrix regelt die Vergabe der Rechte dabei wie folgt: Die Person, welche einen Raum anlegt, ist ihr Administrator, von dieser Person ausgehend können dann alle Rechte wie gewünscht verteilt werden. Somit entsteht zwar ein organisatorischer Aufwand, da Gruppen einzeln mit den gewünschten Rechten konfiguriert werden müssen, auf der anderen Seite gibt es aber den Nutzern der Plattform einen wesentlich höheren Gestaltungfreiraum innerhalb der Gruppen. Dadurch, das die Rechtevergabe nicht auf externen Systemen beruht, sondern selbstständig gemanagt werden kann, entsteht ein hoher Grad an flexibilität bei der Einrichtung von Gruppen, der für einen Messanger Dienst angemessen ist.

% Einfügen einer Grafik
\begin{figure}[htb]
    % Zentrierung
    \centering
    % Einfügen der Datei, mit angepasster Höhe
    \includegraphics[height=15cm]{graphics/moderation3.png}
    % Titel und Label der Grafik
    \caption[Matrix Administrationsoptionen]{Matrix Administrationsoptionen.}
    \label{abb:UI}
\end{figure}
